## DNS란?

> DNS 
>
> : 세상의 수많은 서버를 연결해주는 지표, 최상위 DNS 서버인 루트 DNS 서버는 전 세계에 모두 13대가 있다고 한다.

hosts 파일

- 리눅스의 경우 /etc/hosts 와 같은 파일에 사용자가 임의로 어떤 ip 주소에 대한 domain 이름을 지정할 수 있다.

- 이런 hosts 파일은 사용자가 각 시스템에 접근하는데 도움을 주는 만큼 해커에게도 똑같은 이점을 제공한다. 따라서 hosts 파일을 부실하게 관리하여 해커에게 노출된다면 보안상에 큰 문제가 발생한다.

  

## 네트워크 해킹

1. 스니핑 (snipping)

   > 엿듣기

   - 각 pc는 패킷에 기록된 mac 주소와 ip 주소를 보고 자신에게 제대로 전달된 것인지 여부를 안다. 정상적인 경우라면 자신의 네트워크 카드로 흘러 들어온 패킷에 기록된 MAC 주소와 IP 주소가 PC의 것과 일치하면 패킷을 분석하여 운영체제에 해당 패킷을 할당하고 다르면 버린다.

   - 스니퍼는 자신과 다른 MAC & IP 주소를 가진 패킷이라고 해서 버리지 않는다. 스니퍼는 자신에게 해당 사항이 없는 것을 훔쳐보는 것이 일이다. 패킷의 목적지가 자신이 아니더라도 흘러들어온 패킷을 모두 읽는다. 이처럼 MAC & IP 주소에 관계없이 모든 패킷을 스니퍼에 넘겨주는 것을 프러미스큐어 모드(Promiscuous Mode)라고 한다.

   - 스니핑을 하려면 좋은 랜 카드가 필요하다. 스니핑은 수동적인 공격이므로 패킷을 하나라도 놓치면 전체 그림이 그려지지 않는 경우가 있다. 

   - 프러미스큐어 모드는 기본적으로 소프트웨어적 제어다. 하지만, 하드웨어적으로 처리하는 것도 있는데, 이를 바이패스(Bypass) 모드라고 부른다. 패킷에 대한 분석까지 하드웨어로 구현되어 있는 랜 카드를 말하는데, 보통은 개인이 감당할 수 없는 가격이다. 기가바이트 단위의 백본 망에서 스니핑을 하기 위한 장비이다.

   - 스위칭 환경에서는 기본적으로 스니핑이 어렵다. 스위치는 2계층 장비다. 여기서 '허브'는 랜에서 들어오는 모든 신호를 복사해서 모든 포트에 뿌려주는 역할을 한다. 즉, 브로드캐스트, 유니캐스트 패킷에 상관없이 모든 포트에 신호를 보내주므로 스니퍼에게 스니핑을 이용한 공격은 간단한 일이 될 수 있다. 여기서 '스위치'의 역할이 크다.

   - '스위치'는 모든 포트에 무조건 패킷을 보내 네트워크의 대역폭을 낭비하는 것을 막는다. 스위치 안에는 포트에 대한 MAC 주소 테이블이 존재한다. 스위치가 처음 설치되면 각 장비의 MAC 주소를 확인하여 포트에 할당한다. 포트별로 MAC  주소 값이 할당되면 브로트캐스트 패킷을 제외한 모든 패킷은 목적으로 하는 장비에만 보내진다. 즉, 스니퍼를 저지하는 치명적인 장비가 된다. 처음부터 자신에게 향하지 않은 패킷 외에는 받아볼 수 없기 때문이다. 하지만 스위치를 바보로 만드는 방법은 많다.

     -  스위칭 환경에서 스니핑?

       ARP 리다이렉트 (ARP 스푸핑)

       - 공격자가 자신을 라우터라고 속이는 것, 스푸핑이라고 해도 틀린 말은 아니다. (스니핑을 위한 스푸핑), ARP 리다이렉트는 기본적으로 2계층 공격이며, 랜에서의 공격이라는 사실에는 변함이 없다. 이 공격은 위조된 ARP Reply 패킷을 보내는 방법을 사용한다. 자신의 MAC 주소가 라우터 라며 주기적으로 브로드캐스트 하는 것이다. ARP 스푸핑은 호스트 대 호스트 공격인데, ARP 리다이렉트는 랜의 모든 호스트 대 라우터라는 점 외에는 큰 차이가 없다. ARP 스푸핑처럼 공격자 자신은 원래 라우터의 MAC 주소를 알고 있어야 하며 받은 모든 패킷은 다시 라우터로 릴레이해줘야 한다.

   - 스니핑 공격의 대응책

     - 능동적인 대응책 - 스니퍼 탐지
       - 스니퍼가 네트워트에 존재하는 지를 주기적으로 탐지하는 것
       - 스니퍼를 설치한 이후에는 네트워크에 별다른 이상현상을 만들지 않기 때문에 사용자가 스니핑 공격을 인지하기 어렵다. 
       - 스니퍼 탐지는 기본적으로 스니퍼가 프러미스큐어스 모드에서 작동한다는 데서 시작한다. 
         - ping 을 이용한 탐지 - 스니퍼는 일반 TCP/IP 에서 동작하기 때문에 request 를 받으면 response 를 전달한다. 이를 이용한 방법은 의심이 가는 호스트에  ping을 보낼 때 네트워크에 존재하지 않는 MAC 주소를 위장하여 보낸다. 만약 ICMP Echo Reply 를 받으면 해당 호스트가 스니핑을 하고 있는 것이다. 존재하지 않는 MAC 주소를 사용했으므로 스니핑을 하지 않는 호스트는 ping Request 를 볼 수 없는 것이 정상이기 때문이다.
         - ARP 를 이용한 탐지 - ping과 유사한 방법으로, 위조된 ARP request를 스니퍼임을 확인하고자 하는 시스템에 보내면 대상 시스템이 응답으로 ARP response를 보내게 되고 이를 통해 프러미스큐어스 모드로 동작 중인 스니퍼임을 확인할 수 있다.
         - DNS 를 이용한 탐지 - 일반적으로 스니핑 프로그램은 사용자 편의를 위해 스니핑한 시스템의 IP 주소에 Inverse-DNS lookup 을 수행한다. 이는 원격과 로컬에서 모두 사용할 수 있는 방법으로, 테스트 대상 네트워크로 Ping Sweep 을 보내고 들어오는 Inverse-DNS lookup을 감시하여 스니퍼를 탐지한다.
         - 유인을 이용한 탐지 - 스니핑 공격의 주된 목적은 계정과 패스워트의 획득이다. 보안 관리자는 이점을 이용해 가짜 계정과 패스워드를 네트워크에 계속 뿌린다. 공격자가 이 가짜 계정과 패스워드를 이용해 접속을 시도하면, 접속을 시도하는 시스템을 탐지하여 스니퍼를 탐지할 수 있다.
         - ARP watch를 이용한 탐지 - 초기에 MAC 주소와 IP 주소의 매칭 값을 저장하고 ARP 트래픽을 모니터링하여 이를 변하게 하는 패킷이 탐지되면 관리자에게 메일로 알려주는 툴이다. 대부분 공격 기법이 위조된 ARP를 사용하기 때문에 탐지가 가능하다. 
       - 수동적인 대응책 - 암호화
         - 스니핑을 당하더라돋 내용이 노출되지 않도록 통신 내용을 암호화 하는 방법
           -  SSL(secure socket layer) 의 경우 - 암호화된 웹 서핑을 가능하게 해준다. 많은 웹 서버 브라우저에 구현되어 있다. SSL은 40, 128, 256비트 암호화를 사용하며 현재 우리나라 금융 거래 사이트의 대부분은 128비트 암호화 방식을 쓰고 있다.
           -  PGP (pretty good privacy) & PEM (privacy enhanced mail) & S/MIME - 모두 이메일을 전송할 때 사용하는 암호화 방법 
              -  PGP은 내용을 암호화 하는데 IDEA 방법을 쓰고, IDEA 키와 전자 서명을 암호화하는데 RSA알고리즘을 쓴다. PGP은 기본적으로 'web of trust' 개념을 쓴다. 이는 각각의 PGP 사용자가 서로에 대해 신뢰를 가지며, 서로가 서로에 대한 인증을 해주는 것
              -  PEM은 PGP와 달리 공개키 암호화 표준(PKCS)를 따르며, CA라는 공인된 인증기관에서 키를 관리한다. 데이터 암호화에는 DES-EDE, 키를 위한 암호화 알고리즘에는 RSA, 전자 인증을 위한 해시 함수는 MD2, MD5를 쓴다.
              -  S-MIME는 이메일 표준인 MIME 형식에 암호화 서비스만을 추가한 것 (PKCS를 기반으로 만들어져 있음)
           -   SSH (secure shell) - 텔넷과 같은 서비스 암호화를 위해 사용하는 것으로, 이미 설치한 OpenSSL 라이브러리가 SSH를 지원, DSniff를 이용해 공격을 하면 SSH 를 이용하더라도 공격을 당할 수 있다. 그러나, SSH 암호화 프로토콜은 계속 발전하고 있으며 텔넷보다 안전하다.
           -  VPN (virtual private network) - 원래 한 회선을 여러 회사가 공유하여 비용 절감 하기 위해 개발된 것, 하지만 전송되는 데이터들이 각 회사의 사내 정보이므로 기밀성이 요구되어, VPN은 자연스레 암호화된 트래픽을 제공하게 되었다. 그러나 VPN 시스템이 해킹을 당할 경우 암호화되기 이전에 데이터가 스니핑이 될 수 있다.

2. 스푸핑 (spoofing)

   > 속이기

   - 로컬 네트워크에서 인터넷이 마비되는 경우, 한 컴퓨터의 IP 주소가 라우터의 IP 주소와 똑같은 값으로 설정된 경우, 이는 스푸핑 공격으로 볼 수 있다.
   - 잡아내는 법 - 관리하는 시스템의 mac 주소 테이블을 만들어둔다. 브로드캐스트 ping을 로컬 네트워크로 뿌린다. 그에 답하는 모든 시스템에 대한 mac 주소 값이 시스템 캐시에 기록된다. ARP 테이블이 사리지기 전에 arp -a 로 현재 ip 주소 값과 mac 주소의 대칭 값을 확인한다. 여기서 ip 주소는 라우터인데 mac 주소가 라우터 것이 아닌 항목을 확인한다.
   - ARP(Address Resolution Protocol) 스푸핑 - IP 주소로 MAC 주소 값을 알아내는 프로토콜, ARP 스푸핑은 MAC 주소를 속이는 것, 2계층에서 작동하므로 공격 대상이 같은 랜에 있어야 한다. 
     - 맥주소가 cc 인 호스트가 맥주소가 aa 인 호스트에 bb 의 맥 주소가 cc 라고 속이기
     - 모든 운영체제에서는 mac 주소의 유효성을 주기적으로 확인한다. 따라서 스푸핑된 패킷을 주기적으로 계속 보내야한다.
   - IP 스푸핑 - IP 주소를 속이는 것, 시스템에 접속할 때 자신의 IP 주소로 인증해 로그인하는 트러스트 시스템의 경우 IP만 일치하면 인증을 우회할 수 있다는 치명적인 약점을 나타낸다. 
   - DNS 스푸핑 - 인터넷 주소 창에 원하는 사이트 이름을 입력했더니 엉뚱한 사이트로 연결되는 것, 단순히 DNS 서버를 공격하여 해당 사이트에 접근하지 못하게 하면 DoS 공격이 되지만 조금 응용하면 웹 스푸핑이 된다. DNS 패킷은 UDP 패킷으로 세션이 존재하지 않는다. 먼저 도착한 패킷을 신뢰하며 다음 도착한 정보는 버린다. 이런 점이 DNS 스푸핑에 이용된다.



## 세션 하이재킹 (Session Hijacking)

> 세션 가로채기
>
> session : 사용자와 컴퓨터, 두 컴퓨터 간의 활성화 상태

1. TCP Session Hijacking (Non-Blind Attack)

   - 서버와 클라이언트가 통신할 때 TCP의 시퀀스 넘버를 제어하는 데 문제점이 있음을 알고 진행하는 공격
   - Non-Blind Attack 은 공격 대상을 탐지할 수 있으며 서버와 클라이언트가 통신할 때 시퀀스 넘버를 아는 것이고, Blind Attack 은 이를 몰라 랜덤하게 시퀀스 넘버를 찍어야 하는데 이는 성공 확률이 매우 낮다.
   - 이 공격은 TCP 세션 시퀀스의 동기화 상태를 무너뜨리는 것에서 시작한다. 즉, 서버와 클라이언트를 비동기화 상태로 만드는 것이다. 
   - 비동기화 상태로 만드는 방법 두 가지
     - 서버에서 초기 설정 단계의 접속을 끊고 다른 시퀀스 넘버로 새로운 접속을 생성하는 것
     - 대량의 널(Null) 데이터를 보내는 법

2. MITM (Man In The Middle) 공격

   > 누군가의 사이에 끼어드는 것 (ARP & ICMP 리다이렉트, ARP 스푸핑도 엄밀히 말하면 MITM)

   

---

### SSH 암호화 통신

1. 최초 클라이언트가 SSH를 통해 SSH 서버에 접근하고자 하면, 클라이언트는 서버의 public key를 얻어온다.
2. 클라이언트는 자신의 private key로 데이터를 암호화하고 이를 다시 서버의 public key로 암호화하여 서버로 전송한다.
3. 서버는 클라이언트로부터 전송받은 암호화된 데이터를 자신의 private key로 먼저 복호화한 후, 이를 다시 클라이언트의 public key로 복호화해서 데이터를 읽는다.



## 무선랜

### IEEE 802.11

- IEEE 802 는 컴퓨터 통신망의 표준화를 추진하고 있는 IEEE 802 위원회가 개발한 LAN 접속 방법 및 프로토콜 국제 표준을 지칭한다. 11은 무선 랜과 관련환 표준 위원회를 나타낸다. 



## DoS & DDoS

> DoS (Denial of Service, 서비스 거부) : 공격 대상이 수용할 수 있는 능력 이상의 정보를 제공하거나 사용자 또는 네트워크 용량을 초과시켜 정상적으로 작동하지 못하게 하는 공격
>
> DDoS (Distributed Denial of Service)

특징 3가지

- 파괴 공격 : 디스크, 데이터, 시스템 파괴 (경쟁 음식점을 부수는 것)
- 시스템 자원 고갈 공격 : CPU, 메모리, 디스크의 과다한 사용으로 인한 부하 가중 (음식점에 거짓 주문 장난 전화를 계속 거는 것)
- 네트워크 자원 고갈 공격 : 쓰레기 데이터로 네트워크 대역폭의 고갈 (음식점으로 가는 길에 대규모 공사 시행)



## 방화벽

> 신뢰하지 않는 외부 네트워크와 신뢰하는 내부 네트워크 사이를 지나는 패킷을 미리 정한 규칙에 따라 차단하거나 보내주는 기능을 하는 하드웨어나 소프트웨어를 말한다.
>
> 방화벽은 보통 내부 네트워크와 외부 네트워크의 경계선에 우선 설치한다.
>
> 방화벽이 차단할 수 있는 침입은 30% 정도 이다.
>
> 1차적인 방어막이라고 할 수 있다.

방화벽은 다음과 같은 사안에 따라 침입을 차단할 수 있다.

- 출발지 주소
- 목적지 주소
- 침입을 시도하려는 서비스 (포트 번호)
- 프로토콜

위 사항을 기반, 방화벽은 다음과 같은 기본 원칙에 따라 Rule Set 을 만든다.

- 최소한의 서비스만 제공하고 사용하지 않는 서비스의 포트는 닫는다. 이는 DoS 공격 뿐 아니라 모든 해킹에 대한 기본 대응책이다. 서비스에 필요하지도 않은데 열어놓은 포트는 해커에게 공격 기회를 제공하는 것과 같다.
- 외부 네트워크에서 들어오는 패킷의 출발지 주소가 내부 네트워크에 존재하는 주소지와 일치할 경우 차단한다.
- 침입 차단 시스템 내부의 구성 요소 간 Trust를 금지한다.
- 인증 없이 시스템에 접속할 수 있는 내부/외부 사용자를 허용하지 않는다.
- 명시적인 서비스 외의 모든 서비스를 금지한다.

방화벽의 기능

- 접근 제어 : 통과 시킬 접근과 차단할 접근을 관리자가 명시해주면 이를 행한다. 구현 방법에 따라  Packet Filtering 과 Proxy 방식으로 나뉜다.
- 로깅과 감사 추적 : Logging 을 통해 방화벽을 통과하는 패킷 및 연결에 대한 정보나 관리자의 설정 변경 정보를 저장하고, 정보 시스템 내에 저장된 로그를 이용하여 허용되지 않은 접속 시도 및 연결 등을 확인할 수 있는 감사 추적(Audit Trail) 기능을 제공한다.
- 인증 : 메세지 인증, 사용자 인증, 클라이언트 인증이 있다. 메세지 인증은 VPN과 같은 신뢰하는 통신선으로 전송되는 메세지에 대한 신뢰성을 보장하는 것이다. 사용자 인증은 패스워드를 통한 단순 인증부터 OTP나 토큰 기바노가 같은 높은 수준의 인증도 가능하다. 클라이언트 인증은 모바일 사용자와 같이 특수한 접속을 요구하는 호스트 자체가 정당한 접속 호스트인지 확인하는 것이다.
- 데이터 암호화 : 방화벽에서 다른 방화벽까지 전송되는 데이터를 암호화해서 보내는 것으로 보통 VPN의 기능을 이용한다.

방화벽의 한계

- 바이러스 차단 불가 : 방화벽은 패킷의 IP 주소와 포트 번호로 접근 제어를 하는 것이 보통이다. 따라서 패킷의 내용 자체는 검사하지 않는다. 보통 두 네트워크 사이에 존재하는 방화벽은 높은 트래픽을 처리해야하는데, 여기서 내용 검수까지 하는 것은 오버헤드가 크기 때문이다.
- 내부 공격 차단 불가 : 악의적인 내부 사용자의 공격은 막을 수 없다. 신뢰하지 않는 외부 네트워크 (Outbound Network) 로부터 내부 네트워크를 보호하는 것이 방화벽의 주된 목적이다.

- 자신을 통하지 않은 통신에 대한 제어 불가 : 내부 사용자가 방화벽을 통과하는 통신 선로가 아닌 무선이나 사설 통신 선로로 통신을 한다면, 공격자는 방화벽을 우회 하여 내부 네트워크로 접속할 수 있다. 내부 사용자 역시 방화벽을 우회하여 허용되지 않는 외부로의 접속을 시도할 수 있다.
- 새로운 형태의 공격 차단 불가 : 예측된 접속에 대한 규칙을 세우고 방어를 하는 것이라 새로운 형태의 공격에 능동적 대응이 어렵다. 실제 많은 공격이 방화벽을 우회하거나 통과하여 진행된다.





---

### Reference

[네트워크 해킹과 보안 - 정보 보안 개론과 실습](https://www.aladin.co.kr/shop/wproduct.aspx?ItemId=99699831)
